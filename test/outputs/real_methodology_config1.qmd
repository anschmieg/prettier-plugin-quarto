---
title: "Methodology"
subtitle: "From Research Question to Identification Strategy"
execute:
  echo: false
---

```{r}
#| label: setup
#| include: false

library(data.table)
library(arrow)
library(ggplot2)
library(fixest)
library(patchwork)
library(scales)

# Custom theme for consistent aesthetics (centered titles)
theme_liss <- function() {
    theme_minimal(base_size = 12) +
        theme(
            plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
            plot.subtitle = element_text(color = "gray40", hjust = 0.5),
            panel.grid.minor = element_blank(),
            panel.grid.major.x = element_blank(),
            legend.position = "bottom",
            strip.text = element_text(face = "bold")
        )
}

pal <- c("Treated" = "#E63946", "Control" = "#457B9D", "highlight" = "#F4A261")

df <- as.data.table(read_parquet("../data_processed/liss_tattoo_panel.parquet"))
```

## Research Question and Goals

### Purpose of the Study

The central question of this study is:

> **Do body modifications (i.e. tattoos and piercings) affect labor market outcomes, specifically income?**

This question has significant implications:

* Is there a financial cost to self-expression through body modification?
* Do employers discriminate based on appearance?
* How do signals and stigma operate in the labor market?

As is typical in social science, the main challenge is distinguishing *causation* from *correlation*.
People with tattoos may earn less, but this could be because of several reasons:

1. **Tattoos cause lower wages:** e.g. due to employer discrimination, signaling – this is the treatment effect we are interested in
2. **Lower wages cause tattoos:** inverse to the first explanation, e.g. due to different subcultures, less investment in corporate norms
3. **An unobserved factor causes both:** e.g. risk-taking, impulsivity underly both tattoos AND lower wages
4. **Coincidental correlation:** there is no common identifiable factor, the observed correlation is purely coincidental.

Our goal is to design an empirical strategy that isolates and investigates the first explanation.

***

## LISS Panel Data

**Key Features of the Dataset:**

| Feature           | Description                                          |
| ----------------- | ---------------------------------------------------- |
| **Sample**        | Probability-based sample of Dutch population         |
| **Structure**     | Panel data: same individuals observed repeatedly     |
| **Time period**   | 2008–2025 (up to 18 waves)                           |
| **Key variables** | Income, employment, demographics, body modifications |

<!-- **Useful Characteristics for our Research Question:**

1. **Panel structure** → We can follow individuals over time
2. **Treatment timing** → We know *when* people got their modifications
3. **Rich controls** → Education, employment, demographics available
4. **Representative** → Not a convenience sample -->

***

## Data Engineering

### Step 1: Treatment Definition

We define "treatment" as acquiring a body modification. According to the LISS questionnaire (ja13a module), the key treatment variables are:

* **Tattoos**: Having one or more tattoos (ja13a002: 1–4)
* **Piercings**: Having one or more piercings (ja13a188: 1–3)

::: {.callout-note}
**Important:** The LISS questionnaire explicitly states that "pierced ears also count as piercings."
This means standard ear piercings—which carry little labor market stigma—are included in our treatment variable.
This likely **attenuates** our estimates of any discrimination effect.
:::

<!-- The codebook also includes visibility questions (ja13a015, ja13a197) and location data, which could enable future research distinguishing high-stigma (facial, neck) from low-stigma (concealed, ears) modifications. -->

The *pooled treatment indicator* is:

$$
D_i = \mathbb{1}\{\text{HasTattoo}_i \cup \text{HasPiercing}_i\}
$$

### Step 2: Treatment Timing

The data records *age at modification*, not *calendar year*.
To make this compatible with the LISS panel data, we convert as follows, which gives us the *calendar year of first body modification*.

$$
\text{EventYear}_i = \text{BirthYear}_i + \min(\text{AgeAtTattoo}_i, \text{AgeAtPiercing}_i)
$$

```{r}
#| label: fig-event-year-dist
#| fig-cap: "Distribution of treatment timing. Most treatments occurred before the panel started (2008), but some occur during the panel observation window (red bars)."
#| fig-width: 8
#| fig-height: 4

event_data <- df[!is.na(EventYear) & EventYear >= 1980, .(N = .N), by = EventYear]

ggplot(event_data, aes(x = EventYear, y = N)) +
    geom_col(aes(fill = EventYear >= 2009), width = 0.8, show.legend = FALSE) +
    scale_fill_manual(values = c("FALSE" = "gray70", "TRUE" = pal["Treated"])) +
    geom_vline(xintercept = 2008.5, linetype = "dashed", color = "gray30", linewidth = 0.8) +
    annotate("text",
        x = 2007, y = max(event_data$N) * 0.9,
        label = "Panel starts →", hjust = 1, size = 3.5, color = "gray30"
    ) +
    labs(
        x = "Year of First Body Modification",
        y = "Number of Individuals",
        title = "When Did People Get Their Modifications?",
        subtitle = "Red = during panel observation (usable for DiD)"
    ) +
    scale_x_continuous(breaks = seq(1980, 2025, 5)) +
    theme_liss()
```

### Step 3: Definition of the Outcome Variable

After visual inspection, the income appears to follow a log-normal distribution.
We therefore use *log monthly income* as the outcome variable:

$$
y_{it} = \log(\text{NetMonthlyIncome}_{it})
$$

### Step 4: Construction of the Sample

We apply the following restrictions to the sample:

| Restriction          | Reason                                                                   |
| -------------------- | ------------------------------------------------------------------------ |
| Age 18–65            | Working-age population                                                   |
| Income > 0           | Exclude non-earners and potential data errors                            |
| Non-missing controls | Complete cases only, reduces uncertainty in estimates and interpretation |

```{r}
#| label: compute-sample-stats
#| include: false

df[, LogIncome := ifelse(NetMonthlyIncome > 0, log(NetMonthlyIncome), NA_real_)]

df_analysis <- df[Age >= 18 & Age <= 65 & !is.na(LogIncome)]

n_total <- nrow(df_analysis)
n_individuals <- uniqueN(df_analysis$pid)
n_treated <- df_analysis[EverTreated == 1, uniqueN(pid)]
pct_treated <- round(100 * n_treated / n_individuals, 1)
```

This yields **`r format(n_total, big.mark = ",")`** person-year observations from **`r format(n_individuals, big.mark = ",")`** unique individuals.

***

## Identification Strategy

### Baseline: Cross-Sectional OLS {#sec-baseline-ols}

A simple regression like:

$$
\log(y_i) = \alpha + \beta \cdot \text{HasTattoo}_i + \varepsilon_i
$$

yields the correlation between tattoos and income, but is likely biased because:

::: {.callout-warning}
**Selection bias**: People who get tattoos may structurally differ from those who don't in ways that also affect their earnings,
such as general character traits, risk preferences, social context, etc.
:::

### Difference-in-Differences

By observing people *before* and *after* they get a modification, we can difference out time-invariant confounders,
removing common trends and allowing us to estimate the causal effect of the body modification on income.

#### DiD 2×2 Matrix

Following @card1994minimum, we set up a 2×2 comparison:

<!-- Reference: Card, D., & Krueger, A. B. (1994). Minimum wages and employment. American Economic Review, 84(4), 772-793. -->

|                     | Pre-Treatment            | Post-Treatment            | Change (Δ)          |
| ------------------- | ------------------------ | ------------------------- | ------------------- |
| **Treatment Group** | $\bar{Y}_{T,\text{Pre}}$ | $\bar{Y}_{T,\text{Post}}$ | $\Delta_T$          |
| **Control Group**   | $\bar{Y}_{C,\text{Pre}}$ | $\bar{Y}_{C,\text{Post}}$ | $\Delta_C$          |
| **Difference**      |                          |                           | $\tau_{\text{DiD}}$ |

The DiD estimator is:

$$
\tau_{\text{DiD}} = \Delta_T - \Delta_C = (\bar{Y}_{T,\text{Post}} - \bar{Y}_{T,\text{Pre}}) - (\bar{Y}_{C,\text{Post}} - \bar{Y}_{C,\text{Pre}})
$$

We estimate the DiD effect using a regression model:

$$
Y_{it} = \beta_0 + \beta_1 D_i + \beta_2 \text{Post}_t + \beta_3 (D_i \times \text{Post}_t) + u_{it}
$$

**Coefficient Interpretation:**

| Coefficient   | Meaning                                                                                                                      |
| ------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| $\beta_0$     | Mean outcome for control group, pre-period; *average income of untreated individuals at the start of the observation window* |
| $\beta_1$     | Pre-existing difference (selection effect); *structural difference between treated and untreated individuals*                |
| $\beta_2$     | Time trend affecting both groups                                                                                             |
| **$\beta_3$** | The DiD effect; *change in income for treated individuals excluding the common trend*                                        |

::: {.callout-important}
$\beta_3$ captures the additional change for the treated group beyond the common trend,
which is the **Average Treatment Effect on the Treated (ATT)**.
:::

#### The Two-Way Fixed Effects Model

With panel data, we can use a standard two-way fixed effects model to absorb individual effects and time heterogeneity:

$$$
y_{it} = \alpha_i + \tau_t + \beta \cdot D_{it} + X_{it}'\gamma + \varepsilon_{it}
<!-- prettier-ignore -->
$$ {#eq-twfe}

Where:

- $\alpha_i$ = individual fixed effects (absorbs all time-invariant differences)
- $\tau_t$ = year fixed effects (absorbs common shocks)
- $D_{it}$ = _dummy:_ treatment indicator (= 1 after modification)
- $X_{it}$ = time-varying controls
- $\beta$ = **estimated causal effect** (equivalent to $\beta_3$ in the DiD regression above)

### Core Assumption: Parallel Trends

For $\beta$ to be interpretable as a causal effect, we need to assume that the _parallel trends assumption_ holds,
i.e. in the absence of treatment, the (log) income of treated and control groups would have developed along the same trend.


$$$

\mathbb{E}\[Y\_{i,t+1}(0) - Y\_{it}(0) | D\_i = 1] = \mathbb{E}\[Y\_{i,t+1}(0) - Y\_{it}(0) | D\_i = 0]

$$

In order to determine whether this assumption is reasonable, we perform:

1. **Visual inspection**: Do income trends look parallel before treatment?
2. **Event study**: Are pre-treatment coefficients close to zero?

These tests are presented in the Results chapter (Part III: Model Validation).

---

## Model Specification

### The 4-Model Strategy

As piercings are much more common than tattoos (~11% vs. ~1%), the following issues arise:

1. **Power**: We may not detect a tattoo effect even if one exists, as tattoos are rare in comparison to piercings
2. **Composition**: A pooled estimate mixes different treatments, which may theoretically even have opposing effects
3. **Heterogeneity**: Tattoos and piercings may carry different signals

We estimate four specifications to explore these issues:

| Model | Treatment | Sample | Purpose |
|-------|-----------|--------|---------|
| **A** | Any modification | Full | Maximum power |
| **B** | Piercing only | Exclude tattoo holders | Isolate piercing effect |
| **C** | Tattoo only | Exclude piercing holders | Test rare treatment assumed to be more stigmatized |
| **D** | Both jointly _(logical OR)_ | Full | Estimate separate effects |

<!-- TODO: add a note in the final chapter explaining that one could re-classify treatments into 'high stigma' and 'low stigma'
modifications based on the characteristics in the dataset, but this would decrease sample size even further -->

---

## Limitations & Caveats

1. **Small treated sample**: Few people get modifications during the panel, most were before panel start (2008)
2. **Selection into timing**: *When* people get modifications may be endogenous
3. **Measurement**: We currently do not distinguish visible from hidden modifications as this would add substantial complexity to the data processing pipeline
4. **Staggered adoption**: Treatment timing varies, potentially biasing TWFE

<!-- TODO (DEFERRED): Staggered DiD methods (e.g., Callaway & Sant'Anna 2021, Sun & Abraham 2021)
could address heterogeneous treatment timing. Consider for future work if sample size permits. -->

### Chosen Inference Strategy

We proceed with DiD but interpret results cautiously:

- Report cross-sectional OLS for comparison
- Test parallel trends via event study
- Discuss selection concerns in results interpretation

:::::div{.callout-caution}
Our estimates should be interpreted as _suggestive_ of a causal effect rather than proof. The DiD design addresses some but not all identification concerns.
:::::

<!-- TODO (DEFERRED): Add note in conclusion about reclassifying treatments into 'high stigma' (visible tattoos, facial piercings)
and 'low stigma' (ear piercings, hidden tattoos) categories. -->

$$
